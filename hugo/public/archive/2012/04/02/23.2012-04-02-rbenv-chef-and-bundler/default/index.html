<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Rbenv, chef and bundler | oct.zoy.org</title>
<meta name="keywords" content="ruby">
<meta name="description" content="What we aim
We&rsquo;re trying to use rbenv in our infrastructure in order to achieve the following multiple goals:

Use the latest REE ruby runtime
Switch to Ruby 1.9 for chef
Prepare the migration to rails 3 and Ruby 1.9 for the main web application

So far, I&rsquo;ve managed to install rbenv system wide on the servers using Riot Games excellent cookbook. A simple:">
<meta name="author" content="">
<link rel="canonical" href="https://oct.zoy.org/archive/2012/04/02/23.2012-04-02-rbenv-chef-and-bundler/default/">
<meta name="google-site-verification" content="y8HjH28HsDJmfXel6OVWYfVTlOaM5Y0qt1sSIu4ncXo">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.9ece5999c00778a03c710e924aee5d11de71124f4ac26fb1046ad663031d846b.css" integrity="sha256-ns5ZmcAHeKA8cQ6SSu5dEd5xEk9Kwm&#43;xBGrWYwMdhGs=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js" integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://oct.zoy.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://oct.zoy.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://oct.zoy.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://oct.zoy.org/apple-touch-icon.png">
<link rel="mask-icon" href="https://oct.zoy.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://oct.zoy.org/archive/2012/04/02/23.2012-04-02-rbenv-chef-and-bundler/default/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><script defer data-domain="oct.zoy.org" src="https://plausible.io/js/script.js"></script><meta property="og:title" content="Rbenv, chef and bundler" />
<meta property="og:description" content="What we aim
We&rsquo;re trying to use rbenv in our infrastructure in order to achieve the following multiple goals:

Use the latest REE ruby runtime
Switch to Ruby 1.9 for chef
Prepare the migration to rails 3 and Ruby 1.9 for the main web application

So far, I&rsquo;ve managed to install rbenv system wide on the servers using Riot Games excellent cookbook. A simple:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://oct.zoy.org/archive/2012/04/02/23.2012-04-02-rbenv-chef-and-bundler/default/" /><meta property="article:section" content="archive" />
<meta property="article:published_time" content="2012-04-02T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2012-04-02T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Rbenv, chef and bundler"/>
<meta name="twitter:description" content="What we aim
We&rsquo;re trying to use rbenv in our infrastructure in order to achieve the following multiple goals:

Use the latest REE ruby runtime
Switch to Ruby 1.9 for chef
Prepare the migration to rails 3 and Ruby 1.9 for the main web application

So far, I&rsquo;ve managed to install rbenv system wide on the servers using Riot Games excellent cookbook. A simple:"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Archives",
      "item": "https://oct.zoy.org/archive/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Rbenv, chef and bundler",
      "item": "https://oct.zoy.org/archive/2012/04/02/23.2012-04-02-rbenv-chef-and-bundler/default/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Rbenv, chef and bundler",
  "name": "Rbenv, chef and bundler",
  "description": "What we aim We\u0026rsquo;re trying to use rbenv in our infrastructure in order to achieve the following multiple goals:\nUse the latest REE ruby runtime Switch to Ruby 1.9 for chef Prepare the migration to rails 3 and Ruby 1.9 for the main web application So far, I\u0026rsquo;ve managed to install rbenv system wide on the servers using Riot Games excellent cookbook. A simple:\n",
  "keywords": [
    "ruby"
  ],
  "articleBody": "What we aim We‚Äôre trying to use rbenv in our infrastructure in order to achieve the following multiple goals:\nUse the latest REE ruby runtime Switch to Ruby 1.9 for chef Prepare the migration to rails 3 and Ruby 1.9 for the main web application So far, I‚Äôve managed to install rbenv system wide on the servers using Riot Games excellent cookbook. A simple:\nrequire_recipe \"rbenv\" # Setup the rubies PICOR_RUBY=\"ree-1.8.7-2012.02\" CHEF_RUBY=\"1.9.2-p318\" OPINL_RUBY=\"1.9.2-p318\" rbenv_ruby PICOR_RUBY rbenv_ruby CHEF_RUBY in a chef cookbook, automatically download and install these versions of Ruby in the system wide rbenv. Because I‚Äôm not ready to switch, I‚Äôm not yet setting up automatic rbenv switching:\n# File \"/home/apps/.rbenv-version\" do # owner \"apps\" # group \"apps\" # backup false # content PICOR_RUBY # end # File \"/root/.rbenv-version\" do # owner \"root\" # group \"root\" # backup false # content CHEF_RUBY # end But this should go in action as soon as things works ok.\nNext step, Gems Because Bundle has some kind of memory, you should not use it to deploy gems from a given user if you plan to deploy another gemset in another environement with the SAME user later.\nAt fotopedia, we use GEM_HOME and GEM_PATH to change gemset because it works and it‚Äôs really simple (for binaries, we use a combination of symlinks in /usr/local/bin and alternative selection provided by our Debian OS). So we actually install several gemset with the same user. The workaround to have bundler work correctly is to change its HOME when running. Ugly, but efficient:\nscript \"Bundle picor gems\" do interpreter \"bash\" user \"root\" cwd \"/tmp/\" environment rbenv_as_hash code \u003c\u003c-EOS # Discard previous forced state rm -rf .bundle export HOME=$PWD export RBENV_VERSION=ree-1.8.7-2012.02 rbenv exec gem list bundler | grep 'bundler' || gem install bundler cd /etc/bundler rbenv exec bundle install --shebang ruby-local-exec --binstubs /usr/local/picorstubs EOS action :nothing end This script is run when the Gemfile changes in /etc/bundler (our current location for the Picor gems). the gems chefs are installed almost the same way:\nscript \"Bundle chef gems\" do interpreter \"bash\" user \"root\" cwd \"/root/\" environment rbenv_as_hash code \u0026lt;\u0026lt;-EOS export RBENV_VERSION=ree-1.8.7-2012.02 rbenv execgem list bundler | grep 'bundler' || rbenv exec gem install bundler # Use this because bundle in path is 1.8 bundle rbenv exec bundle install --deployment --shebang ruby-local-exec --binstubs /usr/local/chefstubs EOS action :nothing end Once this has run, /usr/local/picotstubs contains the picor binary stubs ready to be used and the chefstubs the one for chef.\nNext Step. Rewiring daemons to use one gemset according to what I need. Once the stubs are there, this might be straighforward‚Ä¶\n",
  "wordCount" : "430",
  "inLanguage": "en",
  "datePublished": "2012-04-02T00:00:00Z",
  "dateModified": "2012-04-02T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://oct.zoy.org/archive/2012/04/02/23.2012-04-02-rbenv-chef-and-bundler/default/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "oct.zoy.org",
    "logo": {
      "@type": "ImageObject",
      "url": "https://oct.zoy.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://oct.zoy.org/" accesskey="h" title="oct.zoy.org (Alt + H)">
                <img src="https://oct.zoy.org/bandana.png" alt="logo" aria-label="logo"
                    height="30">oct.zoy.org</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://oct.zoy.org/about" title="ü™û about">
                    <span>ü™û about</span>
                </a>
            </li>
            <li>
                <a href="https://oct.zoy.org/as-a-speaker" title="üì¢ speaker">
                    <span>üì¢ speaker</span>
                </a>
            </li>
            <li>
                <a href="https://oct.zoy.org/archives/" title="üï∞Ô∏è Post Archive">
                    <span>üï∞Ô∏è Post Archive</span>
                </a>
            </li>
            <li>
                <a href="https://oct.zoy.org/tags/" title="üîñ tags">
                    <span>üîñ tags</span>
                </a>
            </li>
            <li>
                <a href="https://oct.zoy.org/archive/" title="üï∏Ô∏è old stuff">
                    <span>üï∏Ô∏è old stuff</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<header class="page-header">
  <h1>Rbenv, chef and bundler</h1>
</header>
<div class="archive-year">
  <h2 class="archive-year-header">2025<sup class="archive-count">&nbsp;&nbsp;1</sup>
  </h2>
  <div class="archive-month">
    <h3 class="archive-month-header">April<sup class="archive-count">&nbsp;&nbsp;1</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">Devoxx FR 2025
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2025-04-18 00:00:00 &#43;0000 UTC&#39;&gt;April 18, 2025&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;4 min</div>
        <a class="entry-link" aria-label="post link to Devoxx FR 2025" href="https://oct.zoy.org/posts/2025-04-18-devoxx/"></a>
      </div>
    </div>
  </div>
</div>
<div class="archive-year">
  <h2 class="archive-year-header">2024<sup class="archive-count">&nbsp;&nbsp;3</sup>
  </h2>
  <div class="archive-month">
    <h3 class="archive-month-header">September<sup class="archive-count">&nbsp;&nbsp;1</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üìô Rebuilding Computer Lib
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2024-09-04 00:00:00 &#43;0000 UTC&#39;&gt;September 4, 2024&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;2 min</div>
        <a class="entry-link" aria-label="post link to üìô Rebuilding Computer Lib" href="https://oct.zoy.org/posts/2024-09-04-computer-lib/"></a>
      </div>
    </div>
  </div>
  <div class="archive-month">
    <h3 class="archive-month-header">August<sup class="archive-count">&nbsp;&nbsp;2</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üöÄ Arca ou la nouvelle Eden
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2024-08-31 00:00:00 &#43;0000 UTC&#39;&gt;August 31, 2024&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;1 min</div>
        <a class="entry-link" aria-label="post link to üöÄ Arca ou la nouvelle Eden" href="https://oct.zoy.org/posts/2024-09-01-arca/"></a>
      </div>
      <div class="archive-entry">
        <h3 class="archive-entry-title">‚öîÔ∏è Zorro - d&rsquo;entre les morts
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2024-08-29 00:00:00 &#43;0000 UTC&#39;&gt;August 29, 2024&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;1 min</div>
        <a class="entry-link" aria-label="post link to ‚öîÔ∏è Zorro - d&#39;entre les morts" href="https://oct.zoy.org/posts/2024-08-29-zorro/"></a>
      </div>
    </div>
  </div>
</div>
<div class="archive-year">
  <h2 class="archive-year-header">2023<sup class="archive-count">&nbsp;&nbsp;3</sup>
  </h2>
  <div class="archive-month">
    <h3 class="archive-month-header">August<sup class="archive-count">&nbsp;&nbsp;2</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üìö Lecture d&rsquo;√©t√©
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2023-08-18 00:00:00 &#43;0000 UTC&#39;&gt;August 18, 2023&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;2 min</div>
        <a class="entry-link" aria-label="post link to üìö Lecture d&#39;√©t√©" href="https://oct.zoy.org/posts/2023-08-18-lecture-dete/"></a>
      </div>
      <div class="archive-entry">
        <h3 class="archive-entry-title">üîÜ Summer 2023 - links
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2023-08-02 00:00:00 &#43;0000 UTC&#39;&gt;August 2, 2023&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;1 min</div>
        <a class="entry-link" aria-label="post link to üîÜ Summer 2023 - links" href="https://oct.zoy.org/posts/2023-08-02-links/"></a>
      </div>
    </div>
  </div>
  <div class="archive-month">
    <h3 class="archive-month-header">July<sup class="archive-count">&nbsp;&nbsp;1</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üè¥‚Äç‚ò†Ô∏è Anna&rsquo;s Archive
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2023-07-01 00:00:00 &#43;0000 UTC&#39;&gt;July 1, 2023&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;1 min</div>
        <a class="entry-link" aria-label="post link to üè¥‚Äç‚ò†Ô∏è Anna&#39;s Archive" href="https://oct.zoy.org/posts/2023-07-01-annas-archive/"></a>
      </div>
    </div>
  </div>
</div>
<div class="archive-year">
  <h2 class="archive-year-header">2022<sup class="archive-count">&nbsp;&nbsp;3</sup>
  </h2>
  <div class="archive-month">
    <h3 class="archive-month-header">June<sup class="archive-count">&nbsp;&nbsp;2</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üöò Remote: my setup
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2022-06-29 00:00:00 &#43;0000 UTC&#39;&gt;June 29, 2022&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;4 min</div>
        <a class="entry-link" aria-label="post link to üöò Remote: my setup" href="https://oct.zoy.org/posts/2022-06-29-remote-my-setup/"></a>
      </div>
      <div class="archive-entry">
        <h3 class="archive-entry-title">üè¢ Hiring at Datadog
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2022-06-26 00:00:00 &#43;0000 UTC&#39;&gt;June 26, 2022&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;9 min</div>
        <a class="entry-link" aria-label="post link to üè¢ Hiring at Datadog" href="https://oct.zoy.org/posts/2022-06-26-hiring-at-datadog/"></a>
      </div>
    </div>
  </div>
  <div class="archive-month">
    <h3 class="archive-month-header">January<sup class="archive-count">&nbsp;&nbsp;1</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üöÆ The Ad Blocking Problem
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2022-01-23 00:00:00 &#43;0000 UTC&#39;&gt;January 23, 2022&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;3 min</div>
        <a class="entry-link" aria-label="post link to üöÆ The Ad Blocking Problem" href="https://oct.zoy.org/posts/the-ad-blocking-problem/"></a>
      </div>
    </div>
  </div>
</div>
<div class="archive-year">
  <h2 class="archive-year-header">2021<sup class="archive-count">&nbsp;&nbsp;1</sup>
  </h2>
  <div class="archive-month">
    <h3 class="archive-month-header">March<sup class="archive-count">&nbsp;&nbsp;1</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üö® Git GPG and notifications
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2021-03-30 00:00:00 &#43;0000 UTC&#39;&gt;March 30, 2021&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;2 min</div>
        <a class="entry-link" aria-label="post link to üö® Git GPG and notifications" href="https://oct.zoy.org/posts/git-gpg-and-notifications/"></a>
      </div>
    </div>
  </div>
</div>
<div class="archive-year">
  <h2 class="archive-year-header">2017<sup class="archive-count">&nbsp;&nbsp;4</sup>
  </h2>
  <div class="archive-month">
    <h3 class="archive-month-header">December<sup class="archive-count">&nbsp;&nbsp;1</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">4Ô∏è‚É£ four links
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2017-12-28 00:00:00 &#43;0000 UTC&#39;&gt;December 28, 2017&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;1 min</div>
        <a class="entry-link" aria-label="post link to 4Ô∏è‚É£ four links" href="https://oct.zoy.org/posts/2017-12-28-4-links/"></a>
      </div>
    </div>
  </div>
  <div class="archive-month">
    <h3 class="archive-month-header">April<sup class="archive-count">&nbsp;&nbsp;2</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">5Ô∏è‚É£ five short links
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2017-04-21 00:00:00 &#43;0000 UTC&#39;&gt;April 21, 2017&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;1 min</div>
        <a class="entry-link" aria-label="post link to 5Ô∏è‚É£ five short links" href="https://oct.zoy.org/posts/2017-04-21-five-short-links/"></a>
      </div>
      <div class="archive-entry">
        <h3 class="archive-entry-title">6Ô∏è‚É£ six short links
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2017-04-14 00:00:00 &#43;0000 UTC&#39;&gt;April 14, 2017&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;1 min</div>
        <a class="entry-link" aria-label="post link to 6Ô∏è‚É£ six short links" href="https://oct.zoy.org/posts/2017-04-14/"></a>
      </div>
    </div>
  </div>
  <div class="archive-month">
    <h3 class="archive-month-header">February<sup class="archive-count">&nbsp;&nbsp;1</sup></h3>
    <div class="archive-posts">
      <div class="archive-entry">
        <h3 class="archive-entry-title">üéØ Ansible Tips and Tricks
        </h3>
        <div class="archive-meta">&lt;span title=&#39;2017-02-27 00:00:00 &#43;0000 UTC&#39;&gt;February 27, 2017&lt;/span&gt;&amp;nbsp;¬∑&amp;nbsp;10 min</div>
        <a class="entry-link" aria-label="post link to üéØ Ansible Tips and Tricks" href="https://oct.zoy.org/posts/2017-02-27-ansible-tips-and-tricks-2/"></a>
      </div>
    </div>
  </div>
</div>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="https://oct.zoy.org/">oct.zoy.org</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
